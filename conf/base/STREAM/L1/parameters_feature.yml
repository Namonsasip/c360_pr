# Content Type Features
int_l1_streaming_content_type_features:
    where_clause: ""
    feature_list:
        traffic_rank: "row_number() over (partition by access_method_num, date(register_date), day_id
                                    order by sum(volume_mb) desc)"

#        duration_rank: "row_number() over (partition by access_method_num, date(register_date), day_id
#                                    order by sum(duration) desc)" # duration column is not ingested currently
        traffic_volume_sum: "sum(volume_mb)"
    granularity: "access_method_num, date(register_date), day_id, content_group"

l1_streaming_fav_content_group_by_volume:
    where_clause: "where traffic_rank = 1"
    feature_list:
        access_method_num: access_method_num
        register_date: date(register_date)
        fav_content_group_by_volume: content_group
    granularity: ""
    event_date_column: "day_id"



# TV Channel Features
int_l1_streaming_tv_channel_features:
    where_clause: "where lower(content_group) = 'channel'"
    feature_list:
        tv_channel_rank: "row_number() over (partition by access_method_num, date(register_date), day_id
                                                    order by sum(volume_mb) desc)"
        traffic_volume_sum: "sum(volume_mb)"
    granularity: "access_method_num, date(register_date), day_id, title"

l1_streaming_fav_tv_channel_by_volume:
    where_clause: "where tv_channel_rank = 1"
    feature_list:
        access_method_num: access_method_num
        register_date: date(register_date)
        fav_tv_channel_by_volume: title
    granularity: ""
    event_date_column: "day_id"



# TV Show features
int_l1_streaming_tv_show_features:
    where_clause: "where lower(content_group) = 'episode'"
    feature_list:
        num_of_episode_watched_rank: "row_number() over (partition by access_method_num, date(register_date), day_id
                                                    order by count(distinct title) desc)"
        distinct_title_watched_count: "count(distinct title)"
    granularity: "access_method_num, date(register_date), day_id, series_title"

l1_streaming_fav_tv_show_by_episode_watched:
    where_clause: "where num_of_episode_watched_rank = 1"
    feature_list:
        access_method_num: "access_method_num"
        register_date: "date(register_date)"
        fav_tv_show_by_episode_watched: "series_title"
    granularity: ""
    event_date_column: "day_id"
