l2_loyalty_number_of_services_weekly:
    where_clause: ""
    feature_list:
        loyalty_services_total: "count(*)"
        loyalty_services_travel: "sum(CASE WHEN lower(category_id) like '%travel%'
        or lower(category_text) like '%travel%' THEN 1 ELSE 0 END)"
        loyalty_services_ais_rewards: "sum(CASE WHEN lower(category_id) like '%ais rewards%'
        or lower(category_text) like '%ais rewards%' THEN 1 ELSE 0 END)"
        loyalty_services_entertainment: "sum(CASE WHEN lower(category_id) like '%entertainment%'
        or lower(category_text) like '%entertainment%' THEN 1 ELSE 0 END)"
        loyalty_services_food_and_drink: "sum(CASE WHEN lower(category_id) like '%food%'
        or lower(category_text) like '%food%' THEN 1 ELSE 0 END)"
        loyalty_services_lifestyle: "sum(CASE WHEN lower(category_id) like '%lifestyle%'
        or lower(category_text) like '%lifestyle%' THEN 1 ELSE 0 END)"
        loyalty_services_others: "sum(CASE WHEN lower(category_id) NOT like '%tra%'
        AND lower(category_id) NOT like '%ais rewards%'
        AND lower(category_id) NOT like '%entertainment%'
        AND lower(category_id) NOT like '%food%'
        AND lower(category_id) NOT like '%lifestyle%'
        AND lower(category_text) NOT like '%travel%'
        AND lower(category_text) NOT like '%ais rewards%'
        AND lower(category_text) NOT like '%entertainment%'
        AND lower(category_text) NOT like '%food%'
        AND lower(category_text) NOT like '%lifestyle%' THEN 1 ELSE 0 END)"
        loyalty_privilege_registered_date: "max(to_date(register_date))"
    granularity: "start_of_week,subscription_identifier"


l2_loyalty_number_of_rewards_redeemed_weekly:
    where_clause: ""
    feature_list:
        loyalty_services_total: "count(*)"
        loyalty_services_travel: "sum(CASE WHEN lower(category_id) like '%travel%'
                                        or lower(category_text) like '%travel%' THEN 1 ELSE 0 END)"
        loyalty_services_ais_rewards: "sum(CASE WHEN lower(category_id) like '%ais rewards%'
                                        or lower(category_text) like '%ais rewards%' THEN 1 ELSE 0 END)"
        loyalty_services_entertainment: "sum(CASE WHEN lower(category_id) like '%entertainment%'
                                        or lower(category_text) like '%entertainment%' THEN 1 ELSE 0 END)"
        loyalty_services_food_and_drink: "sum(CASE WHEN lower(category_id) like '%food%'
                                        or lower(category_text) like '%food%' THEN 1 ELSE 0 END)"
        loyalty_services_lifestyle: "sum(CASE WHEN lower(category_id) like '%lifestyle%'
                                        or lower(category_text) like '%lifestyle%' THEN 1 ELSE 0 END)"
        loyalty_services_others: "sum(CASE WHEN lower(category_id) NOT like '%tra%'
                                         AND lower(category_id) NOT like '%ais rewards%'
                                         AND lower(category_id) NOT like '%entertainment%'
                                         AND lower(category_id) NOT like '%food%'
                                         AND lower(category_id) NOT like '%lifestyle%'
                                         AND lower(category_text) NOT like '%travel%'
                                         AND lower(category_text) NOT like '%ais rewards%'
                                         AND lower(category_text) NOT like '%entertainment%'
                                         AND lower(category_text) NOT like '%food%'
                                         AND lower(category_text) NOT like '%lifestyle%' THEN 1 ELSE 0 END)"
    granularity: "start_of_week,subscription_identifier"


l2_loyalty_number_of_points_spend_weekly:
    where_clause: ""
    feature_list:
        loyalty_points_spend_total: "sum(loyalty_points_spend)"
        loyalty_points_spend_travel: "sum(CASE WHEN lower(category_id) like '%travel%'
                                    or lower(category_text) like '%travel%' THEN loyalty_points_spend ELSE 0 END)"
        loyalty_points_spend_ais_rewards: "sum(CASE WHEN lower(category_id) like '%ais rewards%'
                                    or lower(category_text) like '%ais rewards%' THEN loyalty_points_spend ELSE 0 END)"
        loyalty_points_spend_entertainment: "sum(CASE WHEN lower(category_id) like '%entertainment%'
                                    or lower(category_text) like '%entertainment%' THEN loyalty_points_spend ELSE 0 END)"
        loyalty_points_spend_food_and_drink: "sum(CASE WHEN lower(category_id) like '%food%'
                                    or lower(category_text) like '%food%' THEN loyalty_points_spend ELSE 0 END)"
        loyalty_points_spend_lifestyle: "sum(CASE WHEN lower(category_id) like '%lifestyle%'
                                         or lower(category_text) like '%lifestyle%' THEN loyalty_points_spend ELSE 0 END)"
        loyalty_points_spend_others: "sum(CASE WHEN lower(category_id) NOT like '%tra%'
                                     AND lower(category_id) NOT like '%ais rewards%'
                                     AND lower(category_id) NOT like '%entertainment%'
                                     AND lower(category_id) NOT like '%food%'
                                     AND lower(category_id) NOT like '%lifestyle%'
                                     AND lower(category_text) NOT like '%travel%'
                                     AND lower(category_text) NOT like '%ais rewards%'
                                     AND lower(category_text) NOT like '%entertainment%'
                                     AND lower(category_text) NOT like '%food%'
                                     AND lower(category_text) NOT like '%lifestyle%' THEN 1 ELSE 0 END)"
    granularity: "start_of_week, subscription_identifier"
#
#l2_loyalty_serenade_class_weekly:
#    where_clause: ""
#    feature_list:
#        start_of_week: "start_of_week"
#        access_method_num: "access_method_num"
#        register_date: "register_date"
#        subscription_identifier: "subscription_identifier"
#        loyalty_serenade_class: "first_value(ma_segment)
#        over(partition by start_of_week,access_method_num,register_date,subscription_identifier order by last_update desc)"
#        loyalty_is_classic: "case when first_value(ma_segment)
#        over(partition by start_of_week,access_method_num,register_date,subscription_identifier order by last_update desc) in ('Classic') then 'Y' else 'N' end"
#        loyalty_is_emerald: "case when first_value(ma_segment)
#        over(partition by start_of_week,access_method_num,register_date,subscription_identifier order by last_update desc) in ('Emerald') then 'Y' else 'N' end"
#        loyalty_is_gold: "case when first_value(ma_segment)
#        over(partition by start_of_week,access_method_num,register_date,subscription_identifier order by last_update desc) in ('Gold') then 'Y' else 'N' end"
#    granularity: ""