l1_billing_and_payment_feature_top_up_and_count:
  where_clause: "where event_partition_date is not null"
  feature_list:
    payments_top_ups: "sum(case when date(recharge_date) is not null then 1 else 0 end)"
    payments_top_up_volume: "sum(face_value)"
  granularity: "start_of_month,start_of_week,event_partition_date,access_method_num,register_date,subscription_identifier"


l1_billing_and_payment_rpu_roaming:
  where_clause: "where event_partition_date is not null"
  feature_list:
    payments_arpu_roaming: "sum(ir_call_charge_amount)"
  granularity: "start_of_month,start_of_week,event_partition_date,access_method_num,register_date,subscription_identifier"


l1_billing_and_payment_before_top_up_balance:
  where_clause: "where event_partition_date is not null"
  feature_list:
    payments_before_top_up_balance: "avg(pre_bal_amt)"
  granularity: "start_of_month,start_of_week,event_partition_date,access_method_num,register_date,subscription_identifier"


l1_billing_and_payment_top_up_channels:
  where_clause: "where event_partition_date is not null"
  feature_list:
    #payments_top_ups_by_bank_atm_cdm: "sum(case when recharge_type in ('4','B6','B3','B1','B4','B5','B7','B8','41','B2','B9','44','B58','B53','B10','B11') then 1 else 0 end)"
    #payments_top_up_vol_by_bank_atm_cdm: "sum(case when recharge_type in ('4','B6','B3','B1','B4','B5','B7','B8','41','B2','B9','44','B58','B53','B10','B11') then face_value else 0 end)"
    payments_top_ups_by_bank_atm_cdm: "sum(case when (recharge_topup_event_type_name like '%SMS% SCB' or recharge_topup_event_type_name like '%ATM%' or recharge_topup_event_type_name like '%IVR%' or recharge_topup_event_type_name like '%BANKING%' or recharge_topup_event_type_name like '%SMS%BANK%' or recharge_topup_event_type_name like '%AIS AUTO TOP UP%' or recharge_topup_event_type_name like '%CDM CASH DEPOSIT MACHINE%' or recharge_topup_event_type_name like '%MOBILE APPLICATION%' or recharge_topup_event_type_name like '%PAOTANG%APP%') then 1 else 0 end)"
    payments_top_up_vol_by_bank_atm_cdm: "sum(case when (recharge_topup_event_type_name like '%SMS% SCB' or recharge_topup_event_type_name like '%ATM%' or recharge_topup_event_type_name like '%IVR%' or recharge_topup_event_type_name like '%BANKING%' or recharge_topup_event_type_name like '%SMS%BANK%' or recharge_topup_event_type_name like '%AIS AUTO TOP UP%' or recharge_topup_event_type_name like '%CDM CASH DEPOSIT MACHINE%' or recharge_topup_event_type_name like '%MOBILE APPLICATION%' or recharge_topup_event_type_name like '%PAOTANG%APP%') then face_value else 0 end)"
    payments_top_ups_by_cash_card: "sum(case when (recharge_type in ('1','3','B0') and (scratch_type is null or scratch_type <>'P')) then 1 else 0 end)"
    payments_top_up_vol_by_cash_card: "sum(case when (recharge_type in ('1','3','B0') and (scratch_type is null or scratch_type <>'P')) then face_value else 0 end)"
    payments_top_ups_by_digital_online_self_service: "sum(case when recharge_type in ('6','7','8','32','43','16','33','65','37','55','31','36','63','45','B43','B38','B26','B24','B22','B59','B25','B30','B72','B27','B76','B44','B40','B23','B57','B74','B33','B13','B41','B29','B17','B32','B21','B28','B35','B20','B42','B12','B31','B15','B36','B34') then 1 else 0 end)"
    payments_top_up_vol_by_digital_online_self_service: "sum(case when recharge_type in ('6','7','8','32','43','16','33','65','37','55','31','36','63','45','B43','B38','B26','B24','B22','B59','B25','B30','B72','B27','B76','B44','B40','B23','B57','B74','B33','B13','B41','B29','B17','B32','B21','B28','B35','B20','B42','B12','B31','B15','B36','B34') then face_value else 0 end)"
    payments_top_ups_by_epin_slip: "sum(case when (recharge_type in ('1','3','B0') and scratch_type='P') then 1 else 0 end)"
    payments_top_up_vol_by_epin_slip: "sum(case when (recharge_type in ('1','3','B0') and scratch_type='P') then face_value else 0 end)"
    payments_top_ups_by_epos: "sum(case when recharge_type in ('5','18','19','46','53','48','B47','B49','B39','B46','B55','B69','B48') then 1 else 0 end)"
    payments_top_up_vol_by_epos: "sum(case when recharge_type in ('5','18','19','46','53','48','B47','B49','B39','B46','B55','B69','B48') then face_value else 0 end)"
    payments_top_ups_by_rom: "sum(case when recharge_type in ('B50','51') then 1 else 0 end)"
    payments_top_up_vol_by_rom: "sum(case when recharge_type in ('B50','51') then face_value else 0 end)"
  granularity: "start_of_month,start_of_week,event_partition_date,access_method_num,register_date,subscription_identifier"


l1_billing_and_payment_most_popular_topup_channel:
  where_clause: "where event_partition_date is not null"
  feature_list:
    payments_total_top_up: "sum(case when date(recharge_date) is not null then 1 else 0 end)"
  granularity: "start_of_month,start_of_week,event_partition_date,register_date,access_method_num,subscription_identifier,recharge_type"



l1_billing_and_payment_popular_topup_day:
  where_clause: "where event_partition_date is not null"
  feature_list:
    access_method_num: "access_method_num"
    register_date: "register_date"
    subscription_identifier: "subscription_identifier"
    payment_popular_day: "dayofweek(recharge_date)"
    payment_popular_hour: "hour(recharge_time)"
  granularity: ""
  event_date_column: "event_partition_date"

l1_time_since_last_top_up:
  where_clause: "where event_partition_date is not null"
  feature_list:
    access_method_num: "access_method_num"
    register_date: "register_date"
    subscription_identifier: "subscription_identifier"
    recharge_time: "recharge_time"
    face_value: "face_value"
  granularity: ""
  event_date_column: "event_partition_date"





