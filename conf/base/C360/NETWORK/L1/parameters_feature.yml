l1_network_voice_cqi:
  feature_list:
    cei_voice_qoe: cei_voice_qoe
    share_of_drop_calls: sum(cei_voice_voice_drops_after_answers_moc + cei_voice_voice_drops_after_answers_mtc)/sum(cei_voice_call_proceeding_times)
    drop_call_count: cei_voice_voice_drops_after_answers_moc + cei_voice_voice_drops_after_answers_mtc
    total_call_count: sum(cei_voice_call_proceeding_times)
    failed_incoming_call_attempt: moc_attempt_counter_drill_id
    failed_outgoing_call_attempt: mtc_attempt_counter_drill_id
  granularity: "msisdn, partition_date"
  event_date_column: "to_date(cast(partition_date as string), 'yyyyMMdd')"
  output_catalog: "l1_network_total_voice_cqi"
  join_column_with_cust_profile:
    access_method_num: mobile_no
    event_partition_date: event_partition_date
  partition_num_per_job: 360

l1_network_change_of_share_of_drop_call:
  feature_list:
    cei_voice_qoe: cei_voice_qoe
    change_of_share_of_drop_call: "share_of_drop_calls/lag(share_of_drop_calls, 1, 0) over (partition by access_method_num order by event_partition_date asc)"
    share_of_drop_calls: share_of_drop_calls
    drop_call_count: drop_call_count
    total_call_count: total_call_count
    failed_incoming_call_attempt: failed_incoming_call_attempt
    failed_outgoing_call_attempt: failed_outgoing_call_attempt
    access_method_num: access_method_num
    event_partition_date: event_partition_date
  granularity: ""

l1_network_good_and_bad_cells_features:
  feature_list:
    access_method_num: access_method_num
    sum_of_good_cells: sum_of_good_cells
    sum_of_bad_cells: sum_of_good_cells
    cell_id_count: cell_id_count
    share_of_good_cells: share_of_good_cells
    share_of_bad_cells: share_of_bad_cells
  granularity: "" # already grouped in the node
  event_date_column: "to_date(cast(partition_date as string), 'yyyyMMdd')"
  output_catalog: "l1_network_good_and_bad_cells_features"
  join_column_with_cust_profile:
    access_method_num: access_method_num
    event_partition_date: event_partition_date
  partition_num_per_job: 360


l1_network_data_cqi:
  feature_list:
    data_cqi: cei_score
    access_method_num: msisdn
    partition_date: partition_date
  granularity: "" # already grouped from source
  event_date_column: "to_date(cast(partition_date as string), 'yyyyMMdd')"
  output_catalog: "l1_network_data_cqi"
  join_column_with_cust_profile:
    access_method_num: access_method_num
    event_partition_date: event_partition_date
  partition_num_per_job: 360

l1_network_im_cqi:
  feature_list:
    cei_im_qoe: avg(cei_im_qoe)
    sum_im_cqi: sum(cei_im_qoe)
    count_im_cqi: count(*)
  granularity: "msisdn, partition_date"
  event_date_column: "to_date(cast(partition_date as string), 'yyyyMMdd')"
  output_catalog: "l1_network_im_cqi"
  join_column_with_cust_profile:
    access_method_num: access_method_num
    event_partition_date: event_partition_date
  partition_num_per_job: 360

l1_network_streaming_cqi:
  feature_list:
    cei_stream_qoe: avg(cei_stream_qoe)
    sum_streaming_cqi: sum(cei_stream_qoe)
    count_streaming_cqi: count(*)
  granularity: "msisdn, partition_date"
  event_date_column: "to_date(cast(partition_date as string), 'yyyyMMdd')"
  output_catalog: "l1_network_streaming_cqi"
  join_column_with_cust_profile:
    access_method_num: access_method_num
    event_partition_date: event_partition_date
  partition_num_per_job: 360

l1_network_web_cqi:
  feature_list:
    cei_web_qoe: avg(cei_web_qoe)
    sum_web_cqi: sum(cei_web_qoe)
    count_web_cqi: count(*)
  granularity: "msisdn, partition_date"
  event_date_column: "to_date(cast(partition_date as string), 'yyyyMMdd')"
  output_catalog: "l1_network_web_cqi"
  join_column_with_cust_profile:
    access_method_num: access_method_num
    event_partition_date: event_partition_date
  partition_num_per_job: 360

l1_network_voip_cqi:
  feature_list:
    cei_voip_qoe: avg(cei_voip_qoe)
    sum_voip_cqi: sum(cei_voip_qoe)
    count_voip_cqi: count(*)
  granularity: "msisdn, partition_date"
  event_date_column: "to_date(cast(partition_date as string), 'yyyyMMdd')"
  output_catalog: "l1_network_voip_cqi"
  join_column_with_cust_profile:
    access_method_num: access_method_num
    event_partition_date: event_partition_date
  partition_num_per_job: 360

l1_network_volte_cqi:
  feature_list:
    cei_volte_qoe: avg(cei_volte_qoe)
    sum_volte_cqi: sum(cei_volte_qoe)
    count_volte_cqi: count(*)
  granularity: "msisdn, partition_date"
  event_date_column: "to_date(cast(partition_date as string), 'yyyyMMdd')"
  output_catalog: "l1_network_volte_cqi"
  join_column_with_cust_profile:
    access_method_num: access_method_num
    event_partition_date: event_partition_date
  partition_num_per_job: 360