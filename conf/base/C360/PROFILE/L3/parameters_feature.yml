# Config file for query generator
int_l3_customer_profile_basic_features:
  where_clause: ""
  feature_list:
    # this is mandatory for joining to union_features table
    access_method_num: "access_method_num"
    register_date: "register_date"
    subscription_identifier: "crm_sub_id"
    charge_type: "charge_type"
    partition_month: "to_date(cast(partition_month as STRING), 'yyyyMM')"
    last_month: "add_months(to_date(cast(partition_month as STRING), 'yyyyMM'), -1)"
    next_month: "add_months(to_date(cast(partition_month as STRING), 'yyyyMM'), 1)"
    subscription_status: "mobile_status"

    # these are the rest of the features
    age: "floor(months_between(last_day(to_date(cast(partition_month as STRING), 'yyyyMM')), to_date(birth_date))/12)"
    gender: "gender"
    handset_contract_expiry: "contract_end_month"
#    time_with_current_package: "months_between(last_day(to_date(cast(partition_month as STRING), 'yyyyMM')),
#                                    to_date(contract_start_month))"  # wrong formula
    mobile_segment: "mobile_segment"
    serenade_flag: "case when lower(charge_type) = 'pre-paid' then
                            case when mobile_segment = 'MS_CLASSIC' then 'N' else 'Y' end
                      else case when lower(mobile_segment) like 'classic%'
                                      or lower(mobile_segment) like 'standard%'
                                      or lower(mobile_segment) like 'prospect%'
                                      then 'N' else 'Y' end
                      end"
    network_type: "network_type"
    acquisition_channel: "order_channel_new"
    subscriber_tenure: "months_between(last_day(to_date(cast(partition_month as STRING), 'yyyyMM')), to_date(register_date))"
    activation_region: "first_act_region"
    city_of_residence: "crm_most_usage_region"
    current_package_name: "main_promo_name"
    current_package_id: "main_promo_id"
    moc_cust_type: "moc_cust_type"
    national_id_card: "card_no"
    cust_active_this_month: "'Y'"
    billing_account_no: "ba_id"

    # for L4 LTV calculainoution
    norms_net_revenue: norms_net_revenue
  granularity: ""


l3_customer_profile_billing_level_features:
  where_clause: "where ba_id is not null"
  feature_list:
    start_of_month: "max(to_date(cast(partition_month as String),'yyyyMM'))"
    number_of_mobile_devices: "sum(case when imei is not null then 1 else 0 end)"
    number_of_mobile_sims: "sum(case when sim_serial_no is not null then 1 else 0 end)"
    number_of_active_contracts: "count(*)"
  granularity: "ba_id, partition_month"


l3_customer_profile_billing_level_volume_of_active_contracts:
  where_clause: ""
  feature_list:
    start_of_month: "max(to_date(cast(partition_month as String),'yyyyMM'))"
    volume_of_active_contracts: "sum(bill_stmt_tot_invoiced_amt)"
  granularity: "account_num, partition_month"