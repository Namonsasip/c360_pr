l4_device_handset_summary_with_configuration:
    where_clause: ""
    feature_list:
        start_of_month: "start_of_month"
        mobile_no: "mobile_no"
        register_date: "register_date"
        device_brand_code: "first_value(device_brand_code)
                            over(partition by mobile_no,register_date order by cast(cast(start_of_month as timestamp) as long)
                            range between 90*24*60*60 preceding and 1 preceding)"
        device_model_code: "first_value(device_model_code)
                            over(partition by mobile_no,register_date order by cast(cast(start_of_month as timestamp) as long)
                            range between 90*24*60*60 preceding and 1 preceding)"
        device_brand_name: "first_value(device_brand_name)
                            over(partition by mobile_no,register_date order by cast(cast(start_of_month as timestamp) as long)
                            range between 90*24*60*60 preceding and 1 preceding)"
        device_model_name: "first_value(device_model_name)
                            over(partition by mobile_no,register_date order by cast(cast(start_of_month as timestamp) as long)
                            range between 90*24*60*60 preceding and 1 preceding)"
        device_imei: "first_value(device_imei)
                      over(partition by mobile_no,register_date order by cast(cast(start_of_month as timestamp) as long)
                      range between 90*24*60*60 preceding and 1 preceding)"
        device_type: "first_value(device_type)
                      over(partition by mobile_no,register_date order by cast(cast(start_of_month as timestamp) as long)
                      range between 90*24*60*60 preceding and 1 preceding)"
        SmartPhone_device: "first_value(SmartPhone_device)
                            over(partition by mobile_no,register_date order by cast(cast(start_of_month as timestamp) as long)
                            range between 90*24*60*60 preceding and 1 preceding)"
        FeaturePhone_device: "first_value(FeaturePhone_device)
                              over(partition by mobile_no,register_date order by cast(cast(start_of_month as timestamp) as long)
                              range between 90*24*60*60 preceding and 1 preceding)"
        Tablet_device: "first_value(Tablet_device)
                        over(partition by mobile_no,register_date order by cast(cast(start_of_month as timestamp) as long)
                        range between 90*24*60*60 preceding and 1 preceding)"
        Modem_device: "first_value(Modem_device)
                       over(partition by mobile_no,register_date order by cast(cast(start_of_month as timestamp) as long)
                       range between 90*24*60*60 preceding and 1 preceding)"
        SmartWatch_device: "first_value(SmartWatch_device)
                            over(partition by mobile_no,register_date order by cast(cast(start_of_month as timestamp) as long)
                            range between 90*24*60*60 preceding and 1 preceding)"
        Unknown_device: "first_value(Unknown_device)
                         over(partition by mobile_no,register_date order by cast(cast(start_of_month as timestamp) as long)
                         range between 90*24*60*60 preceding and 1 preceding)"
        device_launch_price: "first_value(device_launch_price)
                              over(partition by mobile_no,register_date order by cast(cast(start_of_month as timestamp) as long)
                              range between 90*24*60*60 preceding and 1 preceding)"
        device_sale_price: "first_value(device_sale_price)
                            over(partition by mobile_no,register_date order by cast(cast(start_of_month as timestamp) as long)
                            range between 90*24*60*60 preceding and 1 preceding)"
        device_supports_umts: "first_value(device_supports_umts)
                               over(partition by mobile_no,register_date order by cast(cast(start_of_month as timestamp) as long)
                               range between 90*24*60*60 preceding and 1 preceding)"
        device_supports_wds: "first_value(device_supports_wds)
                              over(partition by mobile_no,register_date order by cast(cast(start_of_month as timestamp) as long)
                              range between 90*24*60*60 preceding and 1 preceding)"
        is_ais_customer: "first_value(is_ais_customer)
                         over(partition by mobile_no,register_date order by cast(cast(start_of_month as timestamp) as long)
                         range between 90*24*60*60 preceding and 1 preceding)"
        device_supports_dual_sim: "first_value(device_supports_dual_sim)
                                   over(partition by mobile_no,register_date order by cast(cast(start_of_month as timestamp) as long)
                                   range between 90*24*60*60 preceding and 1 preceding)"
        device_supports_lte: "first_value(device_supports_lte)
                              over(partition by mobile_no,register_date order by cast(cast(start_of_month as timestamp) as long)
                              range between 90*24*60*60 preceding and 1 preceding)"
        devices_uses_both_sim_slot: "first_value(devices_uses_both_sim_slot)
                                     over(partition by mobile_no,register_date order by cast(cast(start_of_month as timestamp) as long)
                                     range between 90*24*60*60 preceding and 1 preceding)"
        device_supports_hsdpa: "first_value(device_supports_hsdpa)
                                over(partition by mobile_no,register_date order by cast(cast(start_of_month as timestamp) as long)
                                range between 90*24*60*60 preceding and 1 preceding)"
        device_supports_video_call: "first_value(device_supports_video_call)
                                     over(partition by mobile_no,register_date order by cast(cast(start_of_month as timestamp) as long)
                                     range between 90*24*60*60 preceding and 1 preceding)"
        device_operating_system: "first_value(device_operating_system)
                                  over(partition by mobile_no,register_date order by cast(cast(start_of_month as timestamp) as long)
                                  range between 90*24*60*60 preceding and 1 preceding)"
        device_supports_gprs: "first_value(device_supports_gprs)
                               over(partition by mobile_no,register_date order by cast(cast(start_of_month as timestamp) as long)
                               range between 90*24*60*60 preceding and 1 preceding)"
        device_supports_google_map: "first_value(device_supports_google_map)
                                     over(partition by mobile_no,register_date order by cast(cast(start_of_month as timestamp) as long)
                                     range between 90*24*60*60 preceding and 1 preceding)"
    granularity: ""

l4_previous_device_with_config_1:
    where_clause: ""
    feature_list:
        start_of_month: "start_of_month"
        mobile_no: "mobile_no"
        register_date: "register_date"
        handset_imei: "handset_imei"
        handset_brand_code: "handset_brand_code"
        handset_model_code: "handset_model_code"
        handset_brand_name: "handset_brand_name"
        handset_model_name: "handset_model_name"
        device_last_use_time_in_three_months: "max(device_last_use_time) over
                                               (partition by mobile_no,
                                                             register_date,
                                                             handset_imei,
                                                             handset_brand_code,
                                                             handset_model_code,
                                                             handset_brand_name,
                                                             handset_model_name
                                                             order by cast(cast(start_of_month as timestamp) as long) asc
                                                             range between 90 * 24 * 60 * 60 preceding and 1 preceding)"
    granularity: ""

l4_previous_device_with_config_2:
    where_clause: ""
    feature_list:
        start_of_month: "start_of_month"
        mobile_no: "mobile_no"
        register_date: "register_date"
        handset_imei: "handset_imei"
        handset_brand_name: "handset_brand_name"
        device_last_use_time_in_three_months: "device_last_use_time_in_three_months"
        rank: "rank() over
               (partition by mobile_no,
                             register_date,
                             start_of_month
                             order by device_last_use_time_in_three_months desc)"
    granularity: ""

l4_previous_device_with_config_3:
    where_clause: "where rank <= 2"
    feature_list:
        start_of_month: "start_of_month"
        mobile_no: "mobile_no"
        register_date: "register_date"
        handset_imei: "handset_imei"
        handset_brand_name: "handset_brand_name"
        device_last_use_time_in_three_months: "device_last_use_time_in_three_months"
    granularity: ""

l4_previous_device_with_config:
    where_clause: ""
    feature_list:
        start_of_month: "start_of_month"
        mobile_no: "mobile_no"
        register_date: "register_date"
        previous_device_imei: "last_value(handset_imei) over
                               (partition by mobile_no,
                                              register_date,
                                              start_of_month
                                              order by device_last_use_time_in_three_months desc)"
        previous_device_brand: "last_value(handset_brand_name) over
                                (partition by mobile_no,
                                               register_date,
                                               start_of_month
                                               order by device_last_use_time_in_three_months desc)"
    granularity: ""

l4_device_most_used_1:
    where_clause: ""
    feature_list:
        start_of_month: "start_of_month"
        mobile_no: "mobile_no"
        register_date: "register_date"
        handset_brand_name: "handset_brand_name"
        device_use_days_in_three_months: "sum(device_used_days) over
                                               (partition by mobile_no,
                                                             register_date,
                                                             handset_brand_name
                                                             order by cast(cast(start_of_month as timestamp) as long) asc
                                                             range between 90 * 24 * 60 * 60 preceding and 1 preceding)"
    granularity: ""


l4_device_most_used_2:
    where_clause: ""
    feature_list:
        start_of_month: "start_of_month"
        mobile_no: "mobile_no"
        register_date: "register_date"
        handset_brand_name: "handset_brand_name"
        rank: "row_number() over
                            (partition by mobile_no,
                                          register_date,
                                          start_of_month
                                          order by device_use_days_in_three_months desc)"
    granularity: ""

l4_device_most_used_3:
    where_clause: "where rank = 1"
    feature_list:
        start_of_month: "start_of_month"
        mobile_no: "mobile_no"
        register_date: "register_date"
        handset_brand_name: "handset_brand_name"
    granularity: ""

l4_device_most_used:
    where_clause: ""
    feature_list:
        start_of_month: "start_of_month"
        mobile_no: "mobile_no"
        register_date: "register_date"
        most_used_handset_samsung_in_last_three_months: "case when handset_brand_name='SAMSUNG' then 'Y' else 'N' end"
        most_used_handset_huawei_in_last_three_months: "case when handset_brand_name='HUAWEI' then 'Y' else 'N' end"
        most_used_handset_oppo_in_last_three_months: "case when handset_brand_name='OPPO' then 'Y' else 'N' end"
        most_used_handset_apple_in_last_three_months: "case when handset_brand_name='APPLE' then 'Y' else 'N' end"
        most_used_handset_xiaomi_in_last_three_months: "case when handset_brand_name='XIAOMI' then 'Y' else 'N' end"
        most_used_handset_others_in_last_three_months: "case when handset_brand_name not in ('SAMSUNG','HUAWEI','OPPO','APPLE','XIAOMI') then 'Y' else 'N' end"
    granularity: ""
