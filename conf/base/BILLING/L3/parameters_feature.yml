l3_billing_and_payment_feature_top_up_and_count_monthly:
    where_clause: ""
    feature_list:
      payments_top_ups: "sum(payments_top_ups)"
      payments_top_up_volume: "sum(payments_top_up_volume)"
      payments_top_ups_avg: "avg(payments_top_ups_avg)"
      payments_top_up_volume_avg: "avg(payments_top_up_volume_avg)"
    granularity: "start_of_month,access_method_num,date(register_date)"


l3_billing_and_payment_revenue_per_user_monthly:
    where_clause: ""
    feature_list:
      payments_arpu: "sum(norms_net_revenue)"
      payments_arpu_gprs: "sum(norms_net_revenue_gprs)"
      payments_arpu_vas: "sum(norms_net_revenue_vas)"
      payments_arpu_voice: "sum(norms_net_revenue_voice)"
    granularity: "month_id,access_method_num,date(register_date),crm_sub_id"
    event_date_column: "date(month_id)"


l3_billing_and_payment_time_diff_bw_topups_monthly:
    where_clause: ""
    feature_list:
      payments_max_time_diff: "max(payments_max_time_diff)"
      payments_min_time_diff: "min(payments_min_time_diff)"
      payments_time_diff: "sum(payments_time_diff)"
      payments_time_diff_avg: "avg(payments_time_diff_avg)"
    granularity: "start_of_month,access_method_num,date(register_date)"


l3_billing_and_payment_feature_rpu_roaming_monthly:
    where_clause: ""
    feature_list:
      payments_arpu_roaming: "sum(payments_arpu_roaming)"
      payments_arpu_roaming_avg: "avg(payments_arpu_roaming_avg)"
    granularity: "start_of_month,access_method_number,mobile_register_date,crm_sub_id"

l3_billing_and_payment_before_top_up_balance_monthly:
    where_clause: ""
    feature_list:
      payments_before_top_up_balance: "avg(payments_before_top_up_balance)"
    granularity: "start_of_month,access_method_num,account_id"

l3_billing_and_payment_top_up_channels_monthly:
    where_clause: ""
    feature_list:
        payments_top_ups_by_bank_atm_cdm: "sum(payments_top_ups_by_bank_atm_cdm)"
        payments_top_up_vol_by_bank_atm_cdm: "sum(payments_top_up_vol_by_bank_atm_cdm)"
        payments_top_ups_by_cash_card: "sum(payments_top_ups_by_cash_card)"
        payments_top_up_vol_by_cash_card: "sum(payments_top_up_vol_by_cash_card)"
        payments_top_ups_by_digital_online_self_service: "sum(payments_top_ups_by_digital_online_self_service)"
        payments_top_up_vol_by_digital_online_self_service: "sum(payments_top_up_vol_by_digital_online_self_service)"
        payments_top_ups_by_epin_slip: "sum(payments_top_ups_by_epin_slip)"
        payments_top_up_vol_by_epin_slip: "sum(payments_top_up_vol_by_epin_slip)"
        payments_top_ups_by_epos: "sum(payments_top_ups_by_epos)"
        payments_top_up_vol_by_epos: "sum(payments_top_up_vol_by_epos)"
        payments_top_ups_by_rom: "sum(payments_top_ups_by_rom)"
        payments_top_up_vol_by_rom: "sum(payments_top_up_vol_by_rom)"
        payments_top_ups_avg_by_bank_atm_cdm: "avg(payments_top_ups_avg_by_bank_atm_cdm)"
        payments_top_up_vol_avg_by_bank_atm_cdm: "avg(payments_top_up_vol_avg_by_bank_atm_cdm)"
        payments_top_ups_avg_by_cash_card: "avg(payments_top_ups_avg_by_cash_card)"
        payments_top_up_vol_avg_by_cash_card: "avg(payments_top_up_vol_avg_by_cash_card)"
        payments_top_ups_avg_by_digital_online_self_service: "avg(payments_top_ups_avg_by_digital_online_self_service)"
        payments_top_up_vol_avg_by_digital_online_self_service: "avg(payments_top_up_vol_avg_by_digital_online_self_service)"
        payments_top_ups_avg_by_epin_slip: "avg(payments_top_ups_avg_by_epin_slip)"
        payments_top_up_vol_avg_by_epin_slip: "avg(payments_top_up_vol_avg_by_epin_slip)"
        payments_top_ups_avg_by_epos: "avg(payments_top_ups_avg_by_epos)"
        payments_top_up_vol_avg_by_epos: "avg(payments_top_up_vol_avg_by_epos)"
        payments_top_ups_avg_by_rom: "avg(payments_top_ups_avg_by_rom)"
        payments_top_up_vol_avg_by_rom: "avg(payments_top_up_vol_avg_by_rom)"
    granularity: "start_of_month,access_method_num,date(register_date)"

l3_most_popular_topup_channel:
    where_clause: "where rank = 1"
    feature_list:
      start_of_month: "start_of_month"
      access_method_num: "access_method_num"
      register_date: "register_date"
      payments_top_up_channel: "payments_top_up_channel"
      payments_total_top_up: "payments_total_top_up"
    granularity: ""

l3_popular_topup_channel_1:
    where_clause: ""
    feature_list:
      payments_total_top_up: "sum(payments_total_top_up)"
    granularity: "start_of_month,access_method_num,register_date,payments_top_up_channel"

l3_popular_topup_channel_2:
    where_clause: ""
    feature_list:
      start_of_month: "start_of_month"
      access_method_num: "access_method_num"
      register_date: "register_date"
      payments_top_up_channel: "payments_top_up_channel"
      payments_total_top_up: "payments_total_top_up"
      rank: "row_number() over(partition by start_of_month,
             access_method_num,
             register_date order by payments_total_top_up desc)"
    granularity: ""

l3_last_topup_channel_1:
    where_clause: ""
    feature_list:
      start_of_month: "start_of_month"
      start_of_week: "start_of_week"
      access_method_num: "access_method_num"
      register_date: "register_date"
      payments_last_top_up_channel: "payments_last_top_up_channel"
      rank: "row_number() over(partition by start_of_month,
                access_method_num,
                register_date
                order by recharge_time desc)"
    granularity: ""

l3_last_topup_channel_2:
    where_clause: "where rank = 1"
    feature_list:
      start_of_month: "start_of_month"
      start_of_week: "start_of_week"
      access_method_num: "access_method_num"
      register_date: "register_date"
      payments_last_top_up_channel: "payments_last_top_up_channel"
    granularity: ""

l3_automated_flag:
    where_clause: ""
    feature_list:
      automated_payment_flag: "case when sum(case when channel_identifier in ('PM_13','PM_14') then 1
                                                 else 0 end) > 0
                                    then 'Y' else 'N' end"
    granularity: "start_of_month,account_identifier"

l3_bill_volume:
    where_clause: ""
    feature_list:
      payments_bill_volume: "sum(bill_stmt_tot_invoiced_amt)"
    granularity: "start_of_month,account_identifier"
