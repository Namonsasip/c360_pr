l2_billing_and_payment_feature_top_up_and_count_weekly:
    where_clause: ""
    feature_list:
      top_ups: "sum(top_ups)"
      top_up_volume: "sum(top_up_volume)"
      top_ups_avg: "sum(top_ups)/7.0"
      top_up_volume_avg: "avg(top_up_volume)"
    granularity: "start_of_month,start_of_week,access_method_num,date(register_date)"

l2_billing_and_payment_feature_time_diff_bw_topups_weekly_intermdeiate:
    where_clause: ""
    feature_list:
      start_of_month: "date(date_trunc('month',recharge_date))"
      start_of_week: "date(date_trunc('week',recharge_date))"
      recharge_time: "recharge_time"
      access_method_num: "access_method_num"
      register_date: "register_date"
      time_diff: "datediff(recharge_time,lag(recharge_time,1) over(partition by date(date_trunc('month',recharge_date)),
      date(date_trunc('week',recharge_date)),access_method_num,register_date order by recharge_time))"
    granularity: ""

l2_billing_and_payment_feature_time_diff_bw_topups_weekly:
    where_clause: ""
    feature_list:
      max_time_diff: "max(time_diff)"
      min_time_diff: "min(time_diff)"
      time_diff: "sum(time_diff)"
      time_diff_avg: "avg(time_diff)"
    granularity: "start_of_month,start_of_week,access_method_num,date(register_date)"

l2_billing_and_payment_feature_rpu_roaming_weekly:
    where_clause: ""
    feature_list:
      rpu_roaming: "sum(rpu_roaming)"
      arpu_roaming_avg: "avg(rpu_roaming)"
    granularity: "start_of_month,start_of_week,crm_sub_id,access_method_number,mobile_register_date"

l2_billing_and_payment_before_top_up_balance_weekly:
    where_clause: ""
    feature_list:
      before_top_up_balance: "avg(before_top_up_balance)"
    granularity: "start_of_month,start_of_week,access_method_num,account_id"

l2_billing_and_payment_top_up_channels_weekly:
    where_clause: ""
    feature_list:
        top_ups_by_bank_atm_cdm: "sum(top_ups_by_bank_atm_cdm)"
        top_up_vol_by_bank_atm_cdm: "sum(top_up_vol_by_bank_atm_cdm)"
        top_ups_by_cash_card: "sum(top_ups_by_cash_card)"
        top_up_vol_by_cash_card: "sum(top_up_vol_by_cash_card)"
        top_ups_by_digital_online_self_service: "sum(top_ups_by_digital_online_self_service)"
        top_up_vol_by_digital_online_self_service: "sum(top_up_vol_by_digital_online_self_service)"
        top_ups_by_epin_slip: "sum(top_ups_by_epin_slip)"
        top_up_vol_by_epin_slip: "sum(top_up_vol_by_epin_slip)"
        top_ups_by_epos: "sum(top_ups_by_epos)"
        top_up_vol_by_epos: "sum(top_up_vol_by_epos)"
        top_ups_by_rom: "sum(top_ups_by_rom)"
        top_up_vol_by_rom: "sum(top_up_vol_by_rom)"
        top_ups_avg_by_bank_atm_cdm: "avg(top_ups_by_bank_atm_cdm)"
        top_up_vol_avg_by_bank_atm_cdm: "avg(top_up_vol_by_bank_atm_cdm)"
        top_ups_avg_by_cash_card: "avg(top_ups_by_cash_card)"
        top_up_vol_avg_by_cash_card: "avg(top_up_vol_by_cash_card)"
        top_ups_avg_by_digital_online_self_service: "avg(top_ups_by_digital_online_self_service)"
        top_up_vol_avg_by_digital_online_self_service: "avg(top_up_vol_by_digital_online_self_service)"
        top_ups_avg_by_epin_slip: "avg(top_ups_by_epin_slip)"
        top_up_vol_avg_by_epin_slip: "avg(top_up_vol_by_epin_slip)"
        top_ups_avg_by_epos: "avg(top_ups_by_epos)"
        top_up_vol_avg_by_epos: "avg(top_up_vol_by_epos)"
        top_ups_avg_by_rom: "avg(top_ups_by_rom)"
        top_up_vol_avg_by_rom: "avg(top_up_vol_by_rom)"
    granularity: "start_of_month,start_of_week,access_method_num,date(register_date)"

l2_most_popular_topup_channel:
    where_clause: "where rank = 1"
    feature_list:
      start_of_month: "start_of_month"
      start_of_week: "start_of_week"
      access_method_num: "access_method_num"
      register_date: "register_date"
      top_up_channel: "top_up_channel"
      total_top_up: "total_top_up"
    granularity: ""
